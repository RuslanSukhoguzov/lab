# BGearLAN - Локальная файловая синхронизация

Проект предоставляет инструменты для создания локального сервера и клиента для обмена файлами между подключенными пользователями в рамках приложений BGear.

## Основные возможности

- **Автоматическое определение IP-адреса** сети Wi-Fi
- **Многопоточная обработка** клиентских подключений
- **Синхронизация файлов** между сервером и клиентами
- **Проверка целостности** файлов через MD5 хеширование
- **Надежная передача** больших файлов с прогресс-отчетом

## Структура проекта

```
BGearLAN/
├── Data/
│   ├── Server/          # Файлы сервера
│   └── Client/          # Файлы клиентов
├── lan.py            # Основной файл с кодом
└── README.md           # Документация
```

## Классы

### Server

Локальный сервер для обработки клиентских подключений и управления файлами.

#### Инициализация
```python
server = Server(address=auto_ip(), port=2000, report=True, data_dir="BGearLAN/Data/Server")
```

#### Методы
- `listen(max_connects_count=3)` - запускает сервер в режиме прослушивания
- `stop()` - полностью останавливает сервер

### Client

Клиент для подключения к серверу и синхронизации файлов.

#### Инициализация
```python
client = Client(server_address=auto_ip(), server_port=2000, report=True, data_dir="BGearLAN/Data/Client")
```

#### Методы
- `connect()` - подключение к серверу
- `sync_file(filename)` - синхронизация конкретного файла
- `disconnect()` - отключение от сервера

## Протокол взаимодействия

### Команды клиента:

1. **SYNC_REQUEST:filename** - запрос информации о файле для синхронизации
2. **GET_FILE:filename** - запрос на получение файла с сервера
3. **SEND_FILE:filename:filesize** - отправка файла на сервер

### Ответы сервера:

- **FILE_SIZE:size** - информация о размере файла
- **READY** - подтверждение готовности к передаче
- **FILE_RECEIVED** - подтверждение получения файла
- **FILE_NOT_FOUND** - файл не найден
- **ERROR:description** - ошибка обработки

## Пример использования

### Запуск сервера
```python
server = Server()
server.listen()  # Сервер начинает прослушивание подключений
```

### Подключение клиента
```python
client = Client()
if client.connect():
    client.sync_file("test.txt")  # Синхронизация файла
    client.disconnect()
```

### Тестовый сценарий
```python
if __name__ == "__main__":
    # Создание тестового файла
    with open("BGearLAN/Data/Server/test.txt", 'w') as f:
        f.write("Hello World")
    
    # Запуск сервера
    serv = Server()
    serv.listen()
    
    # Подключение клиента и синхронизация
    cli = Client()
    cli.connect()
    cli.sync_file("test.txt")
    
    # Завершение работы
    cli.disconnect()
    serv.stop()
```

## Требования

- Python 3.6+
- Дополнительные зависимости:
  ```bash
  pip install ifaddr
  ```

## Особенности реализации

- **Автоопределение IP**: автоматически определяет IP-адрес Wi-Fi подключения
- **Потокобезопасность**: использование threading.Lock для безопасной работы с клиентами
- **Контроль прогресса**: вывод процента выполнения при передаче файлов
- **Проверка целостности**: MD5 хеширование для проверки идентичности файлов
- **Таймауты**: обработка разрывов соединения и таймаутов

## Обработка ошибок

Код включает обработку различных ошибок:
- Разрыв соединения
- Таймауты приема данных
- Отсутствие файлов
- Ошибки передачи данных

## Примечания

- Сервер по умолчанию использует порт 2000
- Автоматическое определение IP может потребовать настройки для конкретной сетевой конфигурации
- Для работы в различных сетевых окружениях может потребоваться настройка фаервола

## Лицензия

Проект разработан для использования в приложениях BGear.
```
